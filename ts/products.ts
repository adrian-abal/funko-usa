const products = [
  {   
    url: '#',
    name: 'POP! Portgas D. Ace (Execution) with POP! Protector',
    price: '20.00',
    category: 'One Piece',
    media: {
      front: {
        src:'85636_OP_Ace_POP_GLAM-1-FW-WEB.png',
        width: 800,
        height: 800,
        alt: 'POP! Portgas D. Ace (Execution) with POP! Protector',
        aspectRatio: '1/1'
      },
      onHover: {
        src: '85636_OP_Ace_POP_GLAM-WEB.png',
        width: 346,
        height: 346,
        alt: 'POP! Portgas D. Ace (Execution) with POP! Protector',
        aspectRatio: '1/1'
      }
    },
    tag: 'Exclusive',
  },
  {   
    url: '#',
    name: 'POP! Stitch (Concept Art)',
    price: '15.00',
    category: 'Disney',
    media: {
      front: {
        src:'84424_POP_Disney_Stitch_GLAM-1-FunkoWeb-WEB.png',
        width: 800,
        height: 800,
        alt: 'POP! Stitch (Concept Art)',
        aspectRatio: '1/1'
      },
      onHover: {
        src: '84424_POP_Disney_Stitch_GLAM-WEB.png',
        width: 346,
        height: 346,
        alt: 'POP! Stitch (Concept Art)',
        aspectRatio: '1/1'
      }
    },
    tag: 'Exclusive',
   
  },
  {   
    url: '#',
    name: 'POP! Gabrielle with Staff',
    price: '15.00',
    category: 'Xena Warrior Princess',
    media: {
      front: {
        src:'83504_XenaWarriorPrincess_Gabriella_POP_Glam-1-WEB.png',
        width: 800,
        height: 800,
        alt: 'POP! Gabrielle with Staff',
        aspectRatio: '1/1'
      },
      onHover: {
        src: '83504_Xena_Gabrielle_POPTV_Glam-WEB.png',
        width: 346,
        height: 346,
        alt: 'POP! Gabrielle with Staff',
        aspectRatio: '1/1'
      }
    },
    tag: 'Exclusive'
  },
  {   
    url: '#',
    name: 'POP! Denji (Operation: Super-Smart)',
    price: '15.00',
    category: 'Chainsaw man',
    media: {
      front: {
        src:'84569_CSM_S2_DenjiSmartLook_POP_GLAM-1-FW-WEB.png',
        width: 800,
        height: 800,
        alt: 'POP! Denji (Operation: Super-Smart)',
        aspectRatio: '1/1'
      },
      onHover: {
        src: '84569_CSM_S2_DenjiSmartLook_POP_GLAM-WEB.png',
        width: 346,
        height: 346,
        alt: 'POP! Denji (Operation: Super-Smart)',
        aspectRatio: '1/1'
      }
    },
    tag: 'Exclusive'
  },
  {   
    url: '#',
    name: 'POP! Ayrton Senna (Lotus Racing Suit)',
    price: '15.00',
    category: 'Senna',
    media: {
      front: {
        src:'86179_Racing_Lotus_AyrtonSenna_POP_GLAM-1-FunkoWeb-WEB.png',
        width: 800,
        height: 800,
        alt: 'POP! Ayrton Senna (Lotus Racing Suit)',
        aspectRatio: '1/1'
      },
      onHover: {
        src: '86179_Racing_Lotus_AyrtonSenna_POP_GLAM-WEB.png',
        width: 346,
        height: 346,
        alt: 'POP! Ayrton Senna (Lotus Racing Suit)',
        aspectRatio: '1/1'
      }
    },
    tag: 'Exclusive'
  },
  {   
    url: '#',
    name: 'POP! SmokeCheddaThaAssGetta',
    price: '15.00',
    category: 'Saturday Night Live',
    media: {
      front: {
        src:'85083_POP_SNL-50th_Smoke-Chedda_GLAM-1-FW-WEB.png',
        width: 800,
        height: 800,
        alt: 'POP! SmokeCheddaThaAssGetta',
        aspectRatio: '1/1'
      },
      onHover: {
        src: '85083_POP_SNL-50th_Smoke-Chedda_GLAM-WEB.png',
        width: 346,
        height: 346,
        alt: 'POP! SmokeCheddaThaAssGetta',
        aspectRatio: '1/1'
      }
    },
    tag: 'Exclusive'
  },
  {   
    url: '#',
    name: 'POP! Rocky Balboa',
    price: '12.00',
    category: 'Rocky',
    media: {
      front: {
        src:'83548_Rocky_RockyBalboa_POP_GLAM-1-WEB.png',
        width: 800,
        height: 800,
        alt: 'POP! Rocky Balboa',
        aspectRatio: '1/1'
      },
      onHover: {
        src: '83548_Rocky_RockyBalboa_POP_GLAM-WEB.png',
        width: 346,
        height: 346,
        alt: 'POP! Rocky Balboa',
        aspectRatio: '1/1'
      }
    },
    tag: 'New'
  },
  {   
    url: '#',
    name: 'POP! Ivan Drago',
    price: '12.00',
    category: 'Rocky',
    media: {
      front: {
        src:'83549_Rocky_IvanDrago_POP_GLAM-1-WEB.png',
        width: 800,
        height: 800,
        alt: 'POP! Ivan Drago',
        aspectRatio: '1/1'
      },
      onHover: {
        src: '83549_Rocky_IvanDrago_POP_GLAM-WEB.png',
        width: 346,
        height: 346,
        alt: 'POP! Ivan Drago',
        aspectRatio: '1/1'
      }
    },
    tag: 'New'
  },
  {   
    url: '#',
    name: 'POP! Clubber Lang',
    price: '12.00',
    category: 'Rocky',
    media: {
      front: {
        src:'83547_Rocky_ClubberLang_POP_GLAM-1-WEB.png',
        width: 800,
        height: 800,
        alt: 'POP! Clubber Lang',
        aspectRatio: '1/1'
      },
      onHover: {
        src: '83547_Rocky_ClubberLang_POP_GLAM-WEB.png',
        width: 346,
        height: 346,
        alt: 'POP! Clubber Lang',
        aspectRatio: '1/1'
      }
    },
    tag: 'New'
  },
  {   
    url: '#',
    name: 'POP! Front Man',
    price: '12.00',
    category: 'Squid Game',
    media: {
      front: {
        src:'79730_SquidGame_FrontMan_POP_GLAM-1-WEB.png',
        width: 800,
        height: 800,
        alt: 'POP! Front Man',
        aspectRatio: '1/1'
      },
      onHover: {
        src: '79730_SquidGame_FrontMan_POP_GLAM-WEB.png',
        width: 346,
        height: 346,
        alt: 'POP! Front Man',
        aspectRatio: '1/1'
      }
    },
    tag: 'New'
  }
]

const productsContainer = document.querySelector('.products__ul') as HTMLDivElement

fetch('components/products.html')
  .then(response => response.text())
  .then(html => {
    const templateContainer = document.createElement('div')
    templateContainer.innerHTML = html

    // Seleccionar el template
    const template = templateContainer.querySelector('#products__template') as 
    HTMLTemplateElement

    products.forEach(item => {
      let li = document.createElement('li')
      li.className= 'products__li'

      const product = template.content.cloneNode(true) as DocumentFragment

      const overviewLink = product.querySelector('.products__overview') as HTMLAnchorElement
      const titleLink = product.querySelector('.products__a') as HTMLAnchorElement
      const price = product.querySelector('.products__price') as HTMLSpanElement
      const category = product.querySelector('.products__category') as HTMLSpanElement
      const img = product.querySelector('.products__img') as HTMLImageElement
      const tag = product.querySelector('.products__tag') as HTMLSpanElement

      overviewLink.href = item.url
      overviewLink.title = item.name
      titleLink.href = item.url
      titleLink.textContent = item.name
      titleLink.title = item.name
      price.textContent = `$${item.price}`
      category.textContent = item.category
      img.src = `assets/img/products/${item.media.front.src}`
      img.width = item.media.front.width
      img.height = item.media.front.height
      img.alt = item.media.front.alt
      tag.textContent = item.tag
      
      li.appendChild(product)
      productsContainer.appendChild(li)

      // LOADING PRODUCT SLIDER MOVE LOGIC
      productSliderMove()
      overviewOnHover()
})
}).catch(error => console.error('Error al cargar el template:', error))

/* Products slider */
const productSliderMove = () => {
  const productArrows = document.querySelector('.products__arrows') as HTMLDivElement
  const productArrowControl = productArrows.querySelectorAll('.arrows__control') as NodeListOf<HTMLButtonElement>
  const productsUl = document.querySelector('.products__ul') as HTMLDivElement
  const productsLi = document.querySelectorAll('.products__li') as NodeListOf<HTMLLIElement>

  const getProductsPerView = () => {
    const width = window.innerWidth;

    if (width <= 480) return 1;
    if (width <= 768) return 2;
    if (width <= 960) return 3;
    if (width <= 1024) return 4;
    return 5;
  }

  const handleControls = () => {
    if (productStep === 0) {
      productArrowControl[0].disabled = true
      productArrowControl[0].style.visibility = 'hidden'
    } else {
      productArrowControl[0].disabled = false
      productArrowControl[0].style.visibility = 'visible'
    }
    
    if (productStep >= productsLi.length - getProductsPerView()) {
      productArrowControl[1].disabled = true
      productArrowControl[1].style.visibility = 'hidden'
    } else {
      productArrowControl[1].disabled = false
      productArrowControl[1].style.visibility = 'visible'
    }
  }

  let productStep = 0
  handleControls()

  const handleProducts = (direction: string) => {
    if (direction === 'previous') {
      if (productStep > 0) {
        productStep--
      } else {
        productStep = 0
      }
    }
  
    if (direction === 'next') {
      if (productStep < productsLi.length - getProductsPerView()) {
        productStep++
      } else {
        productStep = productsLi.length - getProductsPerView()
      }
    }
  
    let move = 100 / productsLi.length * productStep * -1
    productsUl.style.transform = `translateX(${move}%)`
    
    handleControls()
  }

  productArrows.addEventListener('click', function (e) {
    const target = e.target as HTMLElement
  
    const arrow = target.closest('.arrows__control') as HTMLButtonElement
    if (arrow) {
      const direction = arrow.dataset.direction
      direction ? handleProducts(direction) : ''
    }
  })
}

const overviewOnHover = () => {
  const productsOverviews = document.querySelectorAll('.products__img') as NodeListOf<HTMLImageElement>

productsOverviews.forEach((element, i) => {
  element.addEventListener('mouseover', () => {
    element.src = `assets/img/products/${products[i].media.onHover.src}`
  });

  element.addEventListener('mouseleave', () => {
    element.src = `assets/img/products/${products[i].media.front.src}`
  });
})
}
